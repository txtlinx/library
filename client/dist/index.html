<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Error Library - Front</title>
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/plugins/monthSelect/style.css">
    <link rel="preconnect" href="https://cdn.jsdelivr.net"/>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>
    <style>
      .topbar { position: sticky; top: 0; z-index: 1000; background: #111827; color: #fff; padding: 8px 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.15); }
      .tabs { display: flex; gap: 12px; }
      .tab-btn { background: transparent; color: #fff; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; }
      .tab-btn.active { background: #374151; }
      .hidden { display: none; }
      .topbar-marquee { overflow: hidden; white-space: nowrap; }
      .marquee-track { display: inline-block; will-change: transform; animation: marquee 48s linear infinite; }
      .topbar-marquee:hover .marquee-track { animation-play-state: paused; }
      @keyframes marquee {
        0% { transform: translateX(100%); }
        100% { transform: translateX(-100%); }
      }
      .marquee-label { margin-right: 12px; color: #cbd5e1; }
      .input-with-icon { display: flex; align-items: center; gap: 8px; }
      .input-icon { flex-shrink: 0; }
      .payments-summary-box { width:100%; background:#0a0f1e; border:1px solid #1f2937; border-radius:12px; padding:12px; box-shadow:0 10px 30px rgba(0,0,0,0.4); margin-top:12px; }
      .payments-summary { display:flex; gap:12px; align-items:flex-start; width:100%; justify-content:space-between; flex-wrap: wrap; width: 100%; box-sizing: border-box; }
      .canvas-wrap { position:relative; flex:1 1 560px; background:#0b1220; border:1px solid #1f2937; border-radius:12px; padding:16px 8px 8px; box-shadow:0 8px 24px rgba(0,0,0,0.35); min-width:320px; width: 100%; }
      .canvas-title { position:absolute; top:4px; left:12px; color:#cbd5e1; font-size:13px; z-index:1; }
      .legend { display:flex; flex-direction:column; gap:8px; min-width:260px; flex:1 1 260px; }
      .legend-item { display:flex; align-items:center; gap:8px; padding:8px 10px; border:1px solid #1f2937; border-radius:10px; background:#0b1220; box-shadow:0 4px 14px rgba(0,0,0,0.25); justify-content:space-between; }
      .legend-dot { width:12px; height:12px; border-radius:50%; display:inline-block; }
      .legend-label { color:#94a3b8; font-size:12px; }
      .legend-value { color:#e5e7eb; font-weight:700; margin-left:auto; text-align:right; min-width:120px; }
      /* Subtabs: look like real tabs aligned side by side */
      .subtabs { display:flex; gap:8px; border-bottom:1px solid #1f2937; margin-bottom:12px; }
      .subtab-btn { appearance:none; background:transparent; color:#e5e7eb; border:none; padding:8px 12px; cursor:pointer; border-bottom:2px solid transparent; border-radius:6px 6px 0 0; font-weight:600; }
      .subtab-btn:hover { color:#fff; }
      .subtab-btn.active { color:#fff; border-bottom-color:#3b82f6; }

      /* Inputs alineados y consistentes en el modal de formulario */
      .form-modal label { display:block; font-size:0.95rem; color:#e5e7eb; margin-top:8px; }
      .form-modal input[type="text"],
      .form-modal input[type="file"],
      .form-modal textarea { width:100%; box-sizing:border-box; margin-top:6px; margin-bottom:10px; padding:8px 10px; border:1px solid #1f2937; border-radius:8px; background:#0b1220; color:#e5e7eb; }
      .form-modal textarea { resize:vertical; }

      /* Modo P: difumina contenido sensible dentro de la secciÃ³n con clase .censored */
      #errors-section.censored .censor-title,
      #errors-section.censored .censor-message,
      #errors-section.censored .censor-solution,
      #errors-section.censored .censor-tags { filter: blur(6px); }

      /* ExtensiÃ³n Modo P a tareas y pagos */
      #tasks-section.censored .censor-title,
      #tasks-section.censored .censor-message,
      #tasks-section.censored .censor-tags { filter: blur(6px); }
      #payments-section.censored .censor-title,
      #payments-section.censored .censor-message,
      #payments-section.censored .censor-tags { filter: blur(6px); }

      /* Colapsar listas */
      .collapsible.collapsed { display:none; }

      .container { width: 100%; max-width: 100%; box-sizing: border-box; padding: 16px; overflow-x: hidden; }
      /* Asegurar que los grids internos respeten el ancho */
      #week-view-container, #week-view { width: 100%; max-width: 100%; box-sizing: border-box; }

      /* Evitar que todos los botones sean azules por defecto */
      button { background: inherit; color: inherit; }
      /* Asegurar variantes del tema */
      .btn.btn-danger { background: #ef4444 !important; color: #fff !important; }
      .btn.btn-success { background: #10b981 !important; color: #fff !important; }
      .btn.btn-primary { background: #3b82f6 !important; color: #fff !important; }
      .btn.btn-neutral { background: #6b7280 !important; color: #fff !important; }

      /* Client info layout */
      #client-info {
        margin-bottom: 14px;
        padding: 12px;
        border: 1px solid #164e63;
        border-radius: 14px;
        background: linear-gradient(180deg, rgba(3,12,28,0.95), rgba(2,6,23,0.98));
        box-shadow: 0 14px 34px rgba(0,0,0,0.4), 0 0 0 1px rgba(56,189,248,0.16) inset;
      }
      .client-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 10px;
      }
      .client-item {
        border: 1px solid #1e3a8a;
        border-radius: 10px;
        background: linear-gradient(180deg, #0b1220, #070f1e);
        padding: 10px;
      }
      .client-item .k {
        display: block;
        color: #93c5fd;
        font-size: 12px;
        margin-bottom: 4px;
      }
      .client-item .v {
        color: #e2e8f0;
        font-weight: 800;
        letter-spacing: .2px;
      }

      /* Global form look */
      form {
        background: linear-gradient(180deg, rgba(3, 12, 28, 0.95), rgba(2, 6, 23, 0.98));
        border: 1px solid #164e63;
        border-radius: 14px;
        padding: 14px;
        box-shadow: 0 14px 34px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(56, 189, 248, 0.16) inset;
      }
      form label {
        color: #dbeafe;
        font-weight: 700;
      }
      form input:not([type="checkbox"]):not([type="radio"]),
      form textarea,
      form select {
        border: 1px solid #0ea5e9 !important;
        border-radius: 10px !important;
        background: linear-gradient(180deg, rgba(11, 18, 32, 1), rgba(7, 15, 30, 1)) !important;
        color: #f0f9ff !important;
        box-shadow: 0 1px 0 rgba(125, 211, 252, 0.14) inset;
      }
      form input:focus,
      form textarea:focus,
      form select:focus {
        outline: none;
        border-color: #38bdf8 !important;
        box-shadow: 0 10px 24px rgba(2, 132, 199, 0.35), 0 0 0 1px rgba(125, 211, 252, 0.35) inset, 0 0 0 3px rgba(14, 165, 233, 0.22);
      }
      input, textarea, select { transition: box-shadow 160ms ease, border-color 160ms ease, transform 120ms ease; }
      input:focus, textarea:focus, select:focus {
        outline: none;
        border-color: #38bdf8 !important;
        box-shadow: 0 10px 24px rgba(2, 132, 199, 0.35), 0 0 0 1px rgba(125, 211, 252, 0.35) inset, 0 0 0 3px rgba(14, 165, 233, 0.22);
      }
      form button {
        border-radius: 10px;
        font-weight: 700;
        letter-spacing: 0.2px;
      }

      /* Flatpickr theme custom */
      .flatpickr-calendar {
        background: linear-gradient(180deg, #04111f 0%, #020617 100%);
        border: 1px solid #0ea5e9;
        box-shadow: 0 16px 38px rgba(2, 132, 199, 0.28), 0 0 0 1px rgba(125, 211, 252, 0.2) inset;
        border-radius: 12px;
      }
      .flatpickr-months .flatpickr-month,
      .flatpickr-current-month .flatpickr-monthDropdown-months,
      .flatpickr-current-month input.cur-year {
        color: #e2e8f0 !important;
        fill: #e2e8f0 !important;
      }
      .flatpickr-weekdays,
      span.flatpickr-weekday {
        background: transparent !important;
        color: #7dd3fc !important;
      }
      .flatpickr-day {
        color: #cbd5e1;
        border-radius: 8px;
      }
      .flatpickr-day.today {
        border-color: #38bdf8;
        color: #bae6fd;
      }
      .flatpickr-day.selected,
      .flatpickr-day.startRange,
      .flatpickr-day.endRange {
        background: linear-gradient(135deg, #06b6d4, #2563eb) !important;
        border-color: #7dd3fc !important;
        color: #ffffff !important;
      }
      .flatpickr-day:hover {
        background: rgba(14, 165, 233, 0.2);
        border-color: rgba(56, 189, 248, 0.35);
      }
      .flatpickr-time input,
      .flatpickr-time .flatpickr-am-pm {
        color: #e2e8f0;
      }
    </style>
  </head>
  <body>
    <div class="topbar">
      <div class="tabs">
        <button class="tab-btn active" data-tab="errors">Errores</button>
        <button class="tab-btn" data-tab="tasks">Tareas</button>
        <button class="tab-btn" data-tab="payments">My Money</button>
        <button class="tab-btn" data-tab="notes">Notas</button>
      </div>
      <div class="topbar-marquee"><span class="marquee-track"><span class="marquee-label">PrÃ³xima tarea:</span><span id="next-task-text">cargando...</span></span></div>
    </div>
    <div class="container">
      <h1>Bibliotecas</h1>

      <!-- InformaciÃ³n: IP y relojes -->
      <div id="client-info">
        <div class="client-grid">
          <div class="client-item">
            <span class="k">IP Privada</span>
            <span class="v">IPv4: <span id="ip-v4">cargando...</span></span>
            <span class="v" style="display:block; margin-top:3px;">IPv6: <span id="ip-v6">cargando...</span></span>
          </div>
          <div class="client-item"><span class="k">Hora Local</span><span class="v" id="time-local">--:--:--</span></div>
          <div class="client-item"><span class="k">Hora Santiago (CL)</span><span class="v" id="time-santiago">--:--:--</span></div>
          <div class="client-item"><span class="k">USD â†’ CLP</span><span class="v" id="usd-clp">cargando...</span></div>
          <div class="client-item"><span class="k">USD â†’ BRL</span><span class="v" id="usd-brl">cargando...</span></div>
        </div>
        <div style="margin-top:10px; padding:10px; border:1px solid #1e3a8a; border-radius:10px; background:linear-gradient(180deg,#0b1220,#070f1e);">
          <div style="display:flex; align-items:center; gap:8px; flex-wrap:wrap; margin-bottom:8px;">
            <strong>Conversor:</strong>
            <input id="fx-amount-input" type="number" step="0.01" min="0" placeholder="Escribe un monto" class="input" style="max-width:180px;" />
            <select id="fx-base-currency" class="input" style="max-width:170px;">
              <option value="USD">Monto en USD</option>
              <option value="CLP">Monto en CLP</option>
              <option value="BRL">Monto en BRL</option>
            </select>
          </div>
          <div style="display:flex; gap:10px; flex-wrap:wrap; color:#cbd5e1;">
            <span>CLP: <strong id="fx-out-clp">--</strong></span>
            <span>BRL: <strong id="fx-out-brl">--</strong></span>
            <span>USD: <strong id="fx-out-usd">--</strong></span>
          </div>
        </div>
      </div>

      <section id="errors-section" data-section="errors">
        <section id="create">
          <h2>Crear error</h2>
          <button id="error-create-toggle" type="button" class="btn btn-primary" style="margin-bottom:8px;">Crear error</button>
          <form id="create-form" enctype="multipart/form-data" style="display:none;">
            <label>TÃ­tulo<br/><input name="title" required class="input" /></label><br/>
            <label>Mensaje<br/><textarea name="message" required class="input"></textarea></label><br/>
            <label>Stack (opcional)<br/><textarea name="stack" class="input"></textarea></label><br/>
            <label>SoluciÃ³n<br/><input name="solution" required class="input" /></label><br/>
            <label>Tags (separados por coma)<br/><input name="tags" required class="input" /></label><br/>
            <label>ImÃ¡genes (opcional)<br/><input id="images" name="images" type="file" accept="image/*" multiple class="input" /></label><br/>
            <button type="submit" class="btn btn-success">Crear</button>
          </form>
        </section>

        <h2 style="display:flex; align-items:center; gap:8px;">
          Lista de errores
          <button id="toggle-errors" type="button" class="btn btn-neutral">Contraer</button>
          <button id="errors-censor-toggle" type="button" class="btn btn-neutral">Modo P: OFF</button>
        </h2>

        <div class="filters-row" style="margin-bottom:12px;">
          <label>Orden
            <select id="errors-sort" class="input">
              <option value="desc">Recientes primero</option>
              <option value="asc">Antiguos primero</option>
            </select>
          </label>
          <label>Tags
            <input type="text" id="errors-tag-filter" placeholder="ej: nestjs, prisma" class="input" />
          </label>
          <button id="errors-refresh" type="button" class="btn btn-neutral" title="Ver todos">â†»</button>
        </div>
        <div id="errors-pagination" style="display:flex; align-items:center; gap:8px; margin:8px 0;">
          <button id="errors-page-prev" class="btn btn-neutral" type="button">â—€</button>
          <span id="errors-page-info" style="color:#94a3b8;"></span>
          <button id="errors-page-next" class="btn btn-neutral" type="button">â–¶</button>
          <label style="display:inline-flex; align-items:center; gap:6px; color:#94a3b8;">Por pÃ¡gina
            <select id="errors-page-size" class="input" style="max-width:100px;">
              <option value="5">5</option>
              <option value="10" selected>10</option>
              <option value="20">20</option>
            </select>
          </label>
        </div>
        <ul id="errors" class="collapsible expanded card"></ul>
      </section>
      <section id="tasks-section" data-section="tasks" class="hidden">
        <div class="subtabs">
          <button id="tasks-subtab-list" class="subtab-btn active" type="button" data-subtab="list">Lista</button>
          <button id="tasks-subtab-week" class="subtab-btn" type="button" data-subtab="week">Semana</button>
        </div>
        <h2>Crear tarea</h2>
        <button id="task-create-toggle" type="button" class="btn btn-primary" style="margin-bottom:8px;">Crear tarea</button>
        <form id="task-create-form" style="display:none;">
          <label>TÃ­tulo<br/><input name="title" required /></label><br/>
          <label>DescripciÃ³n (opcional)<br/><textarea name="description"></textarea></label><br/>
          <label>Inicio (ISO)<br/>
            <div class="input-with-icon" style="position:relative;">
              <input name="startAt" id="task-startAt" type="datetime-local" required />
              <button id="task-startAt-btn" type="button" title="Abrir calendario" style="position:absolute; right:8px; top:50%; transform:translateY(-50%); background:#374151; color:#fff; padding:4px 6px; border-radius:4px;">ðŸ“…</button>
            </div>
          </label><br/>
          <label>DuraciÃ³n (minutos)<br/><input name="durationMinutes" type="number" min="1" required /></label><br/>
          <label>Tags (separados por coma)<br/><input name="tags" required /></label><br/>
          <label>Estado<br/>
            <select name="status">
              <option value="">(por defecto: En proceso)</option>
              <option value="IN_PROGRESS">En proceso</option>
              <option value="PAUSED">Detenida</option>
              <option value="STOPPED">Detenido</option>
              <option value="COMPLETED">Terminada</option>
            </select>
          </label><br/>
          <button type="submit">Crear tarea</button>
        </form>

        <h2 style="margin-top: 16px;">Lista de tareas <button id="toggle-tasks" class="toggle-list-btn" type="button">Contraer</button> <button id="tasks-censor-toggle" type="button" title="Ocultar contenido" style="background:#6b7280; margin-left:8px;">Modo P: OFF</button> <button id="tasks-calendar-btn" type="button" title="Calendario" style="background:#374151; margin-left:8px; display:inline-flex; align-items:center; gap:6px;">ðŸ“… Calendario</button></h2>
        <div id="tasks-start-alert" class="card" style="display:none; margin:8px 0 10px; padding:10px; border:1px solid #f59e0b; background:linear-gradient(180deg,#7c2d12,#5b1e0d); color:#fde68a; font-weight:700;"></div>
        <!-- Filtros superiores removidos -->
        <!--
        <div class="filters-row" style="margin-bottom:12px;">
          <label>Orden
            <select id="tasks-sort" class="input">
              <option value="all" selected>Todos</option>
              <option value="start-desc">Inicio mÃ¡s cercano</option>
              <option value="start-asc">Inicio mÃ¡s lejano</option>
              <option value="created-desc">CreaciÃ³n reciente</option>
              <option value="created-asc">CreaciÃ³n antigua</option>
            </select>
          </label>
          <label>DuraciÃ³n mÃ­n (min)
            <input type="number" id="tasks-min-duration" min="0" class="input" />
          </label>
          <label>Estado
            <select id="tasks-status-filter" class="input">
              <option value="">Todos</option>
              <option value="IN_PROGRESS">En proceso</option>
              <option value="PAUSED">Detenida</option>
              <option value="COMPLETED">Terminada</option>
            </select>
          </label>
          <label>Tags
            <input type="text" id="tasks-tag-filter" placeholder="ej: work, feature" class="input" />
          </label>
          <label>Desde
            <input type="date" id="tasks-date-from" class="input" />
          </label>
          <label>Hasta
            <input type="date" id="tasks-date-to" class="input" />
          </label>
          <button id="tasks-date-clear" type="button" class="btn btn-neutral" title="Limpiar rango">Limpiar rango</button>
          <button id="tasks-refresh" type="button" class="btn btn-neutral" title="Ver todos">â†»</button>
        </div>
        <div id="task-filter-chips" style="margin:6px 0 10px;"></div>
        -->
        <div id="tasks-pagination" style="display:flex; align-items:center; gap:8px; margin:8px 0;">
          <button id="tasks-page-prev" class="btn btn-neutral" type="button">â—€</button>
          <span id="tasks-page-info" style="color:#94a3b8;"></span>
          <button id="tasks-page-next" class="btn btn-neutral" type="button">â–¶</button>
          <label style="margin-left:auto; display:inline-flex; align-items:center; gap:6px; color:#94a3b8;">
            Buscar
            <input id="tasks-search-any" type="text" placeholder="TÃ­tulo, tags, estado, fecha..." class="input" style="min-width:260px; max-width:360px; border:1px solid #0ea5e9; border-radius:10px; background:linear-gradient(180deg,#0b1220,#070f1e); color:#f0f9ff; box-shadow:0 1px 0 rgba(125,211,252,0.14) inset;" />
          </label>
          <label style="margin-left:auto; display:inline-flex; align-items:center; gap:6px; color:#94a3b8;">Por pÃ¡gina
            <select id="tasks-page-size" class="input" style="max-width:100px;">
              <option value="5">5</option>
              <option value="10" selected>10</option>
              <option value="20">20</option>
            </select>
          </label>
        </div>
        <ul id="tasks" class="collapsible expanded card"></ul>
        <div id="week-view-container" class="hidden card" style="margin-top:12px;">
          <div style="display:flex; align-items:center; justify-content:space-between; gap:8px; flex-wrap:wrap; margin-bottom:8px;">
            <h3 style="margin:0;">Vista por dÃ­as (Carrusel)</h3>
            <div style="display:flex; align-items:center; gap:8px;">
              <button id="week-carousel-prev" type="button" class="btn btn-neutral" title="DÃ­a anterior (â†)" aria-label="Ver dÃ­a anterior">â—€</button>
              <span id="week-carousel-range" style="color:#cbd5e1; font-weight:700; min-width:220px; text-align:center;"></span>
              <button id="week-carousel-next" type="button" class="btn btn-neutral" title="DÃ­a siguiente (â†’)" aria-label="Ver dÃ­a siguiente">â–¶</button>
            </div>
          </div>
          <div id="week-view"></div>
        </div>
        <!-- Modal Calendario de tareas -->
        <div id="tasks-calendar-modal" style="display:none; position:fixed; inset:0; background:rgba(2,6,23,0.7); backdrop-filter: blur(2px); z-index:1000; align-items:center; justify-content:center; padding:12px; box-sizing:border-box;">
          <div style="background:#0b1220; color:#e5e7eb; padding:16px; border:1px solid #1f2937; border-radius:12px; width:min(96vw, 1280px); max-height:92vh; overflow:auto; box-shadow:0 20px 50px rgba(0,0,0,0.6);">
            <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:12px; gap:8px; flex-wrap:wrap;">
              <strong style="font-size:18px;">Calendario de tareas</strong>
              <div style="display:flex; align-items:center; gap:8px; flex-wrap:wrap;">
                <button id="cal-prev" style="background:#374151; color:#fff; padding:6px 10px; border:none; border-radius:6px; cursor:pointer;">â—€</button>
                <div id="cal-header" style="min-width:160px; text-align:center; font-weight:600; color:#cbd5e1;"></div>
                <button id="cal-next" style="background:#374151; color:#fff; padding:6px 10px; border:none; border-radius:6px; cursor:pointer;">â–¶</button>
                <button id="cal-close" style="background:#ef4444; color:#fff; padding:6px 10px; border:none; border-radius:6px; cursor:pointer;">Cerrar</button>
              </div>
            </div>
            <div id="cal-grid-wrap" style="overflow:auto; width:100%;">
              <div id="cal-grid" style="display:grid; grid-template-columns: repeat(7, minmax(130px, 1fr)); gap:8px; min-width:910px;">
                <!-- headers and days rendered by JS -->
              </div>
            </div>
            <div style="display:flex; align-items:center; justify-content:space-between; margin-top:12px;">
              <small style="color:#cbd5e1;">Leyenda: <span style="display:inline-block; width:10px; height:10px; background:#7c2d12; border:1px solid #f59e0b; border-radius:2px; vertical-align:middle; margin:0 4px 0 8px;"></span> Pasado <span style="display:inline-block; width:10px; height:10px; background:#0b2a5b; border:1px solid #3b82f6; border-radius:2px; vertical-align:middle; margin:0 4px 0 12px;"></span> Futuro</small>
              <small style="color:#94a3b8;">Doble click en ðŸ“… Calendario para limpiar filtro</small>
            </div>
          </div>
        </div>
      </section>
      <section data-section="tasks-board" id="tasks-board-section">
        <h2>Tablero de horarios</h2>
        <div id="tasks-board" class="tasks-board">
          <!-- Hour columns will be rendered by main.js -->
        </div>
      </section>
      <section id="payments-section" data-section="payments" class="hidden">
        <div class="subtabs">
          <button id="payments-subtab-list" class="subtab-btn active" type="button" data-subtab="list">Lista</button>
          <button id="payments-subtab-banks" class="subtab-btn" type="button" data-subtab="banks">Bancos</button>
        </div>
        <div id="payments-subtab-list-view">
        <h2>Crear pago</h2>
        <button id="payment-create-toggle" type="button" class="btn btn-primary" style="margin-bottom:8px;">Crear pago</button>
        <form id="payment-create-form" style="display:none;">
          <label>TÃ­tulo<br/><input name="title" required /></label><br/>
          <label>Monto<br/><input name="amount" type="number" step="0.01" required /></label><br/>
          <label>Tipo<br/>
            <select name="type" required>
              <!-- Por defecto: Gasto extra -->
              <option value="EXTRA_EXPENSE" selected>Gasto extra</option>
              <option value="FIXED_EXPENSE">Gasto fijo</option>
              <option value="INCOME">Ingreso</option>
            </select>
          </label><br/>
          <label>Banco<br/>
            <select name="bank" required>
              <option value="FALABELLA">BANCO FALABELLA</option>
              <option value="ESTADO">BANCO ESTADO</option>
              <option value="CHILE">BANCO DE CHILE</option>
              <option value="SANTANDER">BANCO SANTANDER</option>
            </select>
          </label><br/>
          <label>Mes (YYYY-MM)<br/>
            <span style="display:flex; align-items:center; gap:6px;">
              <input name="month" type="month" />
              <button id="payment-create-month-btn" type="button" title="Abrir calendario" style="background:#3b82f6; color:#fff; padding:6px 8px; border:none; border-radius:6px; cursor:pointer; display:inline-flex; align-items:center; gap:6px;">ðŸ“…</button>
              <button id="payment-create-month-clear" type="button" title="Limpiar mes" style="background:#6b7280; color:#fff; padding:6px 8px; border:none; border-radius:6px; cursor:pointer;">Limpiar</button>
            </span>
          </label><br/>
          <label>Cuotas (1-58, opcional)<br/><input name="installments" type="number" min="1" max="58" /></label><br/>
          <label>Cuota actual pagada (0 si ninguna)<br/><input name="paidInstallments" type="number" min="0" max="58" /></label><br/>
          <button type="submit">Crear pago</button>
        </form>

        <h2 style="margin-top: 16px;">Lista de pagos <button id="toggle-payments" class="btn btn-neutral toggle-list-btn" type="button">Contraer</button> <button id="payments-censor-toggle" type="button" class="btn btn-neutral" title="Ocultar contenido">Modo P: OFF</button> <button id="payments-refresh" type="button" class="btn btn-neutral" title="Ver todos">â†»</button></h2>
        <!-- Filtros superiores removidos -->
        <!--
        <div class="filters-row" style="margin-bottom:12px;">
          <label>Banco
            <select id="payments-bank-filter" style="background:#0b1220; color:#e5e7eb; border:1px solid #334155; border-radius:6px; padding:6px 8px;">
              <option value="">Todos</option>
              <option value="FALABELLA">BANCO FALABELLA</option>
              <option value="ESTADO">BANCO ESTADO</option>
              <option value="SANTANDER">BANCO SANTANDER</option>
            </select>
          </label>
          <label>Tipo
            <select id="payments-type-filter" style="background:#0b1220; color:#e5e7eb; border:1px solid #334155; border-radius:6px; padding:6px 8px;">
              <option value="">Todos</option>
              <option value="INCOME">Ingreso</option>
              <option value="FIXED_EXPENSE">Gasto fijo</option>
              <option value="EXTRA_EXPENSE">Gasto extra</option>
            </select>
          </label>
          <label>Estado
            <select id="payments-status-filter" style="background:#0b1220; color:#e5e7eb; border:1px solid #334155; border-radius:6px; padding:6px 8px;">
              <option value="">Todos</option>
              <option value="PAYING">Pagando</option>
              <option value="PAID">Pagado</option>
              <option value="PAUSED">Detenido</option>
            </select>
          </label>
          <label>Mes
            <span style="display:flex; align-items:center; gap:6px;">
              <input type="month" id="payments-month-filter" class="input" />
              <button id="payments-month-btn" type="button" class="btn btn-primary" title="Abrir calendario">ðŸ“…</button>
              <button id="payments-month-clear" type="button" class="btn btn-neutral" title="Limpiar mes">Limpiar</button>
            </span>
          </label>
          <label>Desde
            <input type="date" id="payments-date-from" class="input" />
          </label>
          <label>Hasta
            <input type="date" id="payments-date-to" class="input" />
          </label>
          <button id="payments-date-clear" type="button" class="btn btn-neutral" title="Limpiar rango">Limpiar rango</button>
        </div>
        <div id="payments-filter-chips" style="margin:6px 0 10px;"></div>
        -->
        <div id="payments-pagination" style="display:flex; align-items:center; gap:8px; margin:8px 0;">
          <button id="payments-page-prev" class="btn btn-neutral" type="button">â—€</button>
          <span id="payments-page-info" style="color:#94a3b8;"></span>
          <button id="payments-page-next" class="btn btn-neutral" type="button">â–¶</button>
          <label style="margin-left:auto; display:inline-flex; align-items:center; gap:6px; color:#94a3b8;">
            Buscar
            <input id="payments-search-any" type="text" placeholder="TÃ­tulo, banco, monto, estado..." class="input" style="min-width:260px; max-width:360px; border:1px solid #0ea5e9; border-radius:10px; background:linear-gradient(180deg,#0b1220,#070f1e); color:#f0f9ff; box-shadow:0 1px 0 rgba(125,211,252,0.14) inset;" />
          </label>
          <label style="display:inline-flex; align-items:center; gap:6px; color:#94a3b8;">Por pÃ¡gina
            <select id="payments-page-size" class="input" style="max-width:100px;">
              <option value="5">5</option>
              <option value="10" selected>10</option>
              <option value="20">20</option>
            </select>
          </label>
        </div>
        <ul id="payments" class="collapsible expanded card"></ul>

        <!-- Charts containers -->
        <div class="payments-summary-box card">
          <div class="payments-summary">
            <div class="canvas-wrap card">
              <span class="canvas-title">Gastos vs Ingresos</span>
              <canvas id="payments-pie" width="720" height="260"></canvas>
            </div>
            <div class="legend">
              <div class="legend-item"><span class="legend-dot" style="background:#ef4444;"></span><span class="legend-label">Gasto fijo:</span> <span id="legend-fixed" class="legend-value">$0</span></div>
              <div class="legend-item"><span class="legend-dot" style="background:#f59e0b;"></span><span class="legend-label">Gasto extra:</span> <span id="legend-extra" class="legend-value">$0</span></div>
              <div class="legend-item"><span class="legend-dot" style="background:#10b981;"></span><span class="legend-label">Ingresos:</span> <span id="legend-income" class="legend-value">$0</span></div>
              <div class="legend-item"><span class="legend-dot" style="background:linear-gradient(45deg,#ef4444,#f59e0b);"></span><span class="legend-label">Total (sin ingresos):</span> <span id="legend-total" class="legend-value">$0</span></div>
              <div class="legend-item"><span class="legend-dot" style="background:linear-gradient(45deg,#10b981,#ef4444);"></span><span class="legend-label">Balance (ingresos - gastos):</span> <span id="legend-balance" class="legend-value">$0</span></div>
            </div>
          </div>
        </div>
        </div>
        <div id="payments-subtab-banks-view" class="hidden">
          <h2 style="margin-top: 4px;">Bancos</h2>
          <p style="color:#94a3b8; margin-top:0;">Resumen por banco con valores fijos editables y totales de pagos.</p>
          <div id="payments-banks-list" class="card" style="display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:12px;"></div>
        </div>
      </section>
      <section id="notes-section" data-section="notes" class="hidden">
        <h2>Crear nota</h2>
        <button id="note-create-toggle" type="button" class="btn btn-primary" style="margin-bottom:8px;">Crear nota</button>
        <form id="note-create-form" style="display:none;">
          <label>TÃ­tulo<br/><input name="title" required /></label><br/>
          <label>Contenido<br/><textarea name="content" required></textarea></label><br/>
          <label>Tags (separados por coma)<br/><input name="tags" /></label><br/>
          <button type="submit">Crear nota</button>
        </form>

        <h2 style="margin-top: 16px;">Notas <button id="toggle-notes" class="btn btn-neutral toggle-list-btn" type="button">Contraer</button> <button id="notes-censor-toggle" type="button" class="btn btn-neutral" title="Ocultar contenido">Modo P: OFF</button></h2>
        <div id="notes-pagination" style="display:flex; align-items:center; gap:8px; margin:8px 0;">
          <button id="notes-page-prev" class="btn btn-neutral" type="button">â—€</button>
          <span id="notes-page-info" style="color:#94a3b8;"></span>
          <button id="notes-page-next" class="btn btn-neutral" type="button">â–¶</button>
          <label style="margin-left:auto; display:inline-flex; align-items:center; gap:6px; color:#94a3b8;">
            Buscar
            <input id="notes-search-any" type="text" placeholder="TÃ­tulo, contenido, tags..." class="input" style="min-width:260px; max-width:360px; border:1px solid #0ea5e9; border-radius:10px; background:linear-gradient(180deg,#0b1220,#070f1e); color:#f0f9ff; box-shadow:0 1px 0 rgba(125,211,252,0.14) inset;" />
          </label>
          <label style="display:inline-flex; align-items:center; gap:6px; color:#94a3b8;">Por pÃ¡gina
            <select id="notes-page-size" class="input" style="max-width:100px;">
              <option value="5">5</option>
              <option value="10" selected>10</option>
              <option value="20">20</option>
            </select>
          </label>
        </div>
        <ul id="notes" class="collapsible expanded card"></ul>
      </section>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/plugins/monthSelect/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/es.js"></script>
    <script src="/main.js"></script>
  </body>
</html>
