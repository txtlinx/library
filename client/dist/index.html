<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Error Library - Front</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/plugins/monthSelect/style.css">
    <link rel="preconnect" href="https://cdn.jsdelivr.net"/>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>
    <style>
      .topbar { position: sticky; top: 0; z-index: 1000; background: linear-gradient(180deg, rgba(2,6,23,0.95), rgba(3,12,28,0.92)); color: #fff; padding: 10px 16px; box-shadow: 0 10px 28px rgba(0,0,0,0.35), 0 0 0 1px rgba(56,189,248,0.15) inset; border-bottom: 1px solid rgba(30,64,175,0.5); backdrop-filter: blur(6px); }
      .topbar-main { display:grid; grid-template-columns:auto minmax(200px,1fr) auto; gap:12px; align-items:center; }
      .tabs { display: flex; gap: 12px; }
      .tab-btn { background: transparent; color: #dbeafe; border: 1px solid transparent; padding: 8px 12px; border-radius: 10px; cursor: pointer; transition: all .16s ease; }
      .tab-btn:hover { border-color: rgba(56,189,248,0.35); background: rgba(15,23,42,0.65); }
      .tab-btn.active { background: linear-gradient(135deg, rgba(8,47,73,0.92), rgba(30,64,175,0.72)); border-color: rgba(125,211,252,0.55); color: #f8fafc; box-shadow: 0 8px 18px rgba(2,132,199,0.25); }
      .hidden { display: none; }
      .topbar-marquee { overflow: hidden; white-space: nowrap; }
      .marquee-track { display: inline-block; will-change: transform; animation: marquee 48s linear infinite; }
      .topbar-marquee:hover .marquee-track { animation-play-state: paused; }
      @keyframes marquee {
        0% { transform: translateX(100%); }
        100% { transform: translateX(-100%); }
      }
      .marquee-label { margin-right: 12px; color: #cbd5e1; }
      #auth-mini { display:flex; align-items:center; gap:8px; flex-wrap:nowrap; justify-content:flex-end; }
      .bell-wrap { position:relative; display:inline-flex; }
      .bell-dot { position:absolute; top:-5px; right:-5px; min-width:18px; height:18px; border-radius:999px; background:#ef4444; color:#fff; font-size:11px; font-weight:800; display:inline-flex; align-items:center; justify-content:center; padding:0 5px; }
      @media (max-width: 980px) {
        .topbar-main { grid-template-columns:1fr; }
        #auth-mini { justify-content:flex-start; }
      }
      .input-with-icon { display: flex; align-items: center; gap: 8px; }
      .input-icon { flex-shrink: 0; }
      .payments-summary-box { width:100%; background:#0a0f1e; border:1px solid #1f2937; border-radius:12px; padding:12px; box-shadow:0 10px 30px rgba(0,0,0,0.4); margin-top:12px; }
      .payments-summary { display:flex; gap:12px; align-items:flex-start; width:100%; justify-content:space-between; flex-wrap: wrap; width: 100%; box-sizing: border-box; }
      .canvas-wrap { position:relative; flex:1 1 560px; background:#0b1220; border:1px solid #1f2937; border-radius:12px; padding:16px 8px 8px; box-shadow:0 8px 24px rgba(0,0,0,0.35); min-width:320px; width: 100%; }
      .canvas-title { position:absolute; top:4px; left:12px; color:#cbd5e1; font-size:13px; z-index:1; }
      .legend { display:flex; flex-direction:column; gap:8px; min-width:260px; flex:1 1 260px; }
      .legend-item { display:flex; align-items:center; gap:8px; padding:8px 10px; border:1px solid #1f2937; border-radius:10px; background:#0b1220; box-shadow:0 4px 14px rgba(0,0,0,0.25); justify-content:space-between; }
      .legend-dot { width:12px; height:12px; border-radius:50%; display:inline-block; }
      .legend-label { color:#94a3b8; font-size:12px; }
      .legend-value { color:#e5e7eb; font-weight:700; margin-left:auto; text-align:right; min-width:120px; }
      /* Subtabs: look like real tabs aligned side by side */
      .subtabs { display:flex; gap:8px; border-bottom:1px solid #1f2937; margin-bottom:12px; }
      .subtab-btn { appearance:none; background:transparent; color:#cbd5e1; border:none; padding:8px 12px; cursor:pointer; border-bottom:2px solid transparent; border-radius:8px 8px 0 0; font-weight:600; transition: all .16s ease; }
      .subtab-btn:hover { color:#fff; }
      .subtab-btn.active { color:#fff; border-bottom-color:#38bdf8; background: rgba(8,47,73,0.25); }

      /* Inputs alineados y consistentes en el modal de formulario */
      .form-modal label { display:block; font-size:1.1rem; color:#e5e7eb; margin-top:8px; }
      .form-modal input[type="text"],
      .form-modal input[type="file"],
      .form-modal textarea { width:100%; box-sizing:border-box; margin-top:6px; margin-bottom:10px; padding:8px 10px; border:1px solid #1f2937; border-radius:8px; background:#0b1220; color:#e5e7eb; font-size:1.1rem; }
      .form-modal textarea { resize:vertical; }

      /* Modo P: difumina contenido sensible dentro de la secci√≥n con clase .censored */
      #errors-section.censored .censor-title,
      #errors-section.censored .censor-message,
      #errors-section.censored .censor-solution,
      #errors-section.censored .censor-tags { filter: blur(6px); }

      /* Extensi√≥n Modo P a tareas y pagos */
      #tasks-section.censored .censor-title,
      #tasks-section.censored .censor-message,
      #tasks-section.censored .censor-tags { filter: blur(6px); }
      #payments-section.censored .censor-title,
      #payments-section.censored .censor-message,
      #payments-section.censored .censor-tags { filter: blur(6px); }

      /* Colapsar listas */
      .collapsible.collapsed { display:none; }

      .container { width: 100%; max-width: 100%; box-sizing: border-box; padding: 16px; overflow-x: hidden; }
      /* Asegurar que los grids internos respeten el ancho */
      #week-view-container, #week-view { width: 100%; max-width: 100%; box-sizing: border-box; }

      /* Evitar que todos los botones sean azules por defecto */
      button { background: inherit; color: inherit; }
      /* Asegurar variantes del tema */
      .btn.btn-danger { background: #ef4444 !important; color: #fff !important; }
      .btn.btn-success { background: #10b981 !important; color: #fff !important; }
      .btn.btn-primary { background: #3b82f6 !important; color: #fff !important; }
      .btn.btn-neutral { background: #6b7280 !important; color: #fff !important; }

      /* Client info layout */
      #client-info {
        margin-bottom: 14px;
        padding: 12px;
        border: 1px solid #164e63;
        border-radius: 14px;
        background: linear-gradient(180deg, rgba(3,12,28,0.95), rgba(2,6,23,0.98));
        box-shadow: 0 14px 34px rgba(0,0,0,0.4), 0 0 0 1px rgba(56,189,248,0.16) inset;
      }
      .client-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 10px;
      }
      .client-item {
        border: 1px solid #1e3a8a;
        border-radius: 10px;
        background: linear-gradient(180deg, #0b1220, #070f1e);
        padding: 10px;
      }
      .client-item .k {
        display: block;
        color: #93c5fd;
        font-size: 12px;
        margin-bottom: 4px;
      }
      .client-item .v {
        color: #e2e8f0;
        font-weight: 800;
        letter-spacing: .2px;
      }

      /* Global form look */
      form {
        background: linear-gradient(180deg, rgba(3, 12, 28, 0.95), rgba(2, 6, 23, 0.98));
        border: 1px solid #164e63;
        border-radius: 14px;
        padding: 14px;
        box-shadow: 0 14px 34px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(56, 189, 248, 0.16) inset;
      }
      form label {
        color: #dbeafe;
        font-weight: 700;
        font-size: 1.1rem;
      }
      form input:not([type="checkbox"]):not([type="radio"]),
      form textarea,
      form select {
        border: 1px solid #0ea5e9 !important;
        border-radius: 10px !important;
        background: linear-gradient(180deg, rgba(11, 18, 32, 1), rgba(7, 15, 30, 1)) !important;
        color: #f0f9ff !important;
        box-shadow: 0 1px 0 rgba(125, 211, 252, 0.14) inset;
        font-size: 1.1rem;
      }
      form input:focus,
      form textarea:focus,
      form select:focus {
        outline: none;
        border-color: #38bdf8 !important;
        box-shadow: 0 10px 24px rgba(2, 132, 199, 0.35), 0 0 0 1px rgba(125, 211, 252, 0.35) inset, 0 0 0 3px rgba(14, 165, 233, 0.22);
      }
      input, textarea, select { transition: box-shadow 160ms ease, border-color 160ms ease, transform 120ms ease; }
      input:focus, textarea:focus, select:focus {
        outline: none;
        border-color: #38bdf8 !important;
        box-shadow: 0 10px 24px rgba(2, 132, 199, 0.35), 0 0 0 1px rgba(125, 211, 252, 0.35) inset, 0 0 0 3px rgba(14, 165, 233, 0.22);
      }
      form button {
        border-radius: 10px;
        font-weight: 700;
        letter-spacing: 0.2px;
      }

      /* Flatpickr: estilo azul glass acorde al tema */
      .flatpickr-calendar {
        background: linear-gradient(180deg, rgba(5, 20, 41, 0.98) 0%, rgba(2, 10, 26, 0.98) 100%) !important;
        border: 1px solid rgba(56, 189, 248, 0.62) !important;
        box-shadow:
          0 22px 50px rgba(2, 132, 199, 0.30),
          0 0 0 1px rgba(125, 211, 252, 0.22) inset,
          0 0 22px rgba(14, 165, 233, 0.28);
        border-radius: 14px !important;
        overflow: hidden;
      }
      .flatpickr-months {
        background: linear-gradient(135deg, rgba(8, 47, 73, 0.9), rgba(30, 64, 175, 0.7)) !important;
        border-bottom: 1px solid rgba(125, 211, 252, 0.28);
      }
      .flatpickr-months .flatpickr-prev-month,
      .flatpickr-months .flatpickr-next-month {
        color: #e0f2fe !important;
        fill: #e0f2fe !important;
      }
      .flatpickr-months .flatpickr-prev-month:hover,
      .flatpickr-months .flatpickr-next-month:hover {
        color: #ffffff !important;
      }
      .flatpickr-current-month .flatpickr-monthDropdown-months,
      .flatpickr-current-month input.cur-year {
        color: #f0f9ff !important;
        fill: #f0f9ff !important;
        font-weight: 700;
      }
      .flatpickr-weekdays,
      span.flatpickr-weekday {
        background: rgba(8, 27, 58, 0.75) !important;
        color: #7dd3fc !important;
      }
      .flatpickr-weekday {
        font-weight: 700 !important;
      }
      .flatpickr-days {
        background: linear-gradient(180deg, rgba(2, 12, 30, 0.92), rgba(3, 16, 38, 0.92));
      }
      .flatpickr-day {
        color: #dbeafe;
        border-radius: 10px !important;
        border: 1px solid transparent;
        transition: all .15s ease;
      }
      .flatpickr-day.today {
        border-color: rgba(56, 189, 248, 0.65) !important;
        color: #e0f2fe !important;
        box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.25) inset;
      }
      .flatpickr-day:hover {
        background: rgba(14, 165, 233, 0.24) !important;
        border-color: rgba(56, 189, 248, 0.42) !important;
        color: #ffffff !important;
        transform: translateY(-1px);
      }
      .flatpickr-day.selected,
      .flatpickr-day.startRange,
      .flatpickr-day.endRange {
        background: linear-gradient(135deg, #06b6d4, #2563eb) !important;
        border-color: rgba(186, 230, 253, 0.9) !important;
        color: #ffffff !important;
        box-shadow: 0 8px 16px rgba(37, 99, 235, 0.35);
      }
      .flatpickr-day.inRange {
        background: rgba(37, 99, 235, 0.22) !important;
        border-color: rgba(96, 165, 250, 0.34) !important;
      }
      .flatpickr-day.flatpickr-disabled,
      .flatpickr-day.flatpickr-disabled:hover {
        color: #64748b !important;
        background: transparent !important;
        border-color: transparent !important;
        transform: none;
      }
      .flatpickr-time {
        background: rgba(8, 27, 58, 0.75);
        border-top: 1px solid rgba(125, 211, 252, 0.24);
      }
      .flatpickr-time input,
      .flatpickr-time .flatpickr-am-pm {
        color: #e2e8f0 !important;
      }
      .flatpickr-time input:hover,
      .flatpickr-time .flatpickr-am-pm:hover,
      .flatpickr-time input:focus,
      .flatpickr-time .flatpickr-am-pm:focus {
        background: rgba(14, 165, 233, 0.18);
      }
      .flatpickr-monthSelect-month {
        border-radius: 10px !important;
        border: 1px solid transparent !important;
        color: #dbeafe !important;
      }
      .flatpickr-monthSelect-month:hover {
        background: rgba(14, 165, 233, 0.24) !important;
        border-color: rgba(56, 189, 248, 0.42) !important;
      }
      .flatpickr-monthSelect-month.selected {
        background: linear-gradient(135deg, #06b6d4, #2563eb) !important;
        border-color: rgba(186, 230, 253, 0.9) !important;
        color: #fff !important;
      }

      /* Global blue-glass theme aligned with notifications */
      :root {
        --ui-bg-1: #020617;
        --ui-bg-2: #071a34;
        --ui-bg-3: #08214a;
        --ui-card: linear-gradient(180deg, rgba(7,19,41,.96), rgba(8,29,58,.92));
        --ui-border: rgba(56,189,248,.30);
        --ui-border-strong: rgba(125,211,252,.55);
        --ui-text: #e2e8f0;
        --ui-muted: #93c5fd;
        --ui-shadow: 0 20px 48px rgba(2,132,199,.22);
      }
      body {
        background-image:
          radial-gradient(circle at 12% 18%, rgba(14,165,233,.16), transparent 38%),
          radial-gradient(circle at 84% 10%, rgba(37,99,235,.18), transparent 34%),
          linear-gradient(180deg, var(--ui-bg-1), var(--ui-bg-2) 55%, var(--ui-bg-3));
        color: var(--ui-text);
      }
      .container {
        background: linear-gradient(180deg, rgba(6,16,36,.94), rgba(8,27,58,.94)) !important;
        border: 1px solid var(--ui-border) !important;
        box-shadow: var(--ui-shadow), 0 0 0 1px rgba(125,211,252,.16) inset !important;
      }
      section,
      .card,
      li,
      .card-item,
      form {
        background: var(--ui-card) !important;
        border: 1px solid var(--ui-border) !important;
        box-shadow: 0 10px 24px rgba(2,132,199,.14) !important;
      }
      li:hover,
      .card:hover {
        border-color: var(--ui-border-strong) !important;
        box-shadow: 0 14px 30px rgba(2,132,199,.22) !important;
      }
      h1, h2, h3, h4, strong { color: #e0f2fe !important; }
      small, .created-date, .legend-label { color: var(--ui-muted) !important; }

      .topbar {
        background: linear-gradient(180deg, rgba(7,26,52,.98), rgba(8,33,74,.96)) !important;
        border-bottom: 1px solid var(--ui-border-strong) !important;
        box-shadow: 0 18px 40px rgba(2,132,199,.24), 0 0 0 1px rgba(56,189,248,.18) inset !important;
      }
      .tab-btn,
      .subtab-btn {
        color: #bfdbfe !important;
        border-color: transparent !important;
      }
      .tab-btn:hover,
      .subtab-btn:hover {
        background: linear-gradient(135deg, rgba(8,47,73,.45), rgba(30,64,175,.34)) !important;
        border-color: var(--ui-border) !important;
      }
      .tab-btn.active,
      .subtab-btn.active {
        color: #fff !important;
        background: linear-gradient(135deg, rgba(14,116,144,.54), rgba(37,99,235,.52)) !important;
        border-color: var(--ui-border-strong) !important;
        box-shadow: 0 10px 22px rgba(2,132,199,.24) !important;
      }

      button,
      .btn {
        border: 1px solid rgba(125,211,252,.35) !important;
        box-shadow: 0 8px 18px rgba(2,132,199,.20) !important;
      }
      .btn.btn-primary { background: linear-gradient(135deg,#0ea5e9,#2563eb) !important; }
      .btn.btn-success { background: linear-gradient(135deg,#059669,#0891b2) !important; }
      .btn.btn-neutral { background: linear-gradient(135deg,#334155,#1e293b) !important; }
      .btn.btn-danger { background: linear-gradient(135deg,#b91c1c,#dc2626) !important; }

      input:not([type="checkbox"]):not([type="radio"]),
      textarea,
      select,
      .input {
        background: transparent !important;
        border: none !important;
        border-bottom: 1px solid rgba(125,211,252,.55) !important;
        border-radius: 0 !important;
        color: #e0f2fe !important;
        box-shadow: none !important;
        caret-color: #7dd3fc !important;
        transition: border-bottom-color .2s ease, box-shadow .2s ease, background-color .2s ease !important;
      }
      input:focus,
      textarea:focus,
      select:focus,
      .input:focus {
        border-color: #67e8f9 !important;
        border-bottom-width: 2px !important;
        background: linear-gradient(180deg, rgba(14,165,233,.08), rgba(14,165,233,0)) !important;
        box-shadow:
          0 1px 0 0 rgba(56,189,248,.98),
          0 0 14px rgba(56,189,248,.34),
          0 12px 26px -16px rgba(2,132,199,.72) !important;
      }

      #client-info,
      .client-item,
      .payments-summary-box,
      .canvas-wrap,
      .legend-item {
        background: var(--ui-card) !important;
        border: 1px solid var(--ui-border) !important;
      }
      body[data-ui-theme="soft"] {
        --ui-card: linear-gradient(180deg, rgba(8,20,42,.92), rgba(10,30,60,.88));
        --ui-border: rgba(125,211,252,.22);
        --ui-border-strong: rgba(186,230,253,.38);
        --ui-shadow: 0 12px 28px rgba(2,132,199,.14);
      }
      body[data-ui-theme="midnight"] {
        --ui-bg-1: #01030b;
        --ui-bg-2: #061127;
        --ui-bg-3: #0b1d45;
        --ui-card: linear-gradient(180deg, rgba(5,12,26,.96), rgba(7,20,44,.92));
        --ui-border: rgba(37,99,235,.30);
        --ui-border-strong: rgba(96,165,250,.55);
      }
      body[data-ui-theme="aurora"] {
        --ui-bg-1: #04101f;
        --ui-bg-2: #072a45;
        --ui-bg-3: #0a3b66;
        --ui-card: linear-gradient(180deg, rgba(5,24,48,.95), rgba(8,47,73,.9));
        --ui-border: rgba(34,211,238,.30);
        --ui-border-strong: rgba(103,232,249,.62);
      }
      body[data-ui-theme="blue"] {
        --ui-bg-1: #2c9ed8;
        --ui-bg-2: #3a79cc;
        --ui-bg-3: #3b4fbf;
        --ui-card: linear-gradient(180deg, rgba(44,158,216,.28), rgba(59,79,191,.30));
        --ui-border: rgba(219,234,254,.44);
        --ui-border-strong: rgba(241,245,249,.82);
        --ui-shadow: 0 16px 34px rgba(30,64,175,.28);
      }
    </style>
  </head>
  <body>
    <div class="topbar">
      <div class="topbar-main">
        <div class="tabs">
          <button class="tab-btn" data-tab="tasks">Tareas</button>
          <button class="tab-btn" data-tab="payments">Mi Dinero</button>
          <button class="tab-btn active" data-tab="notes">Notas</button>
          <button class="tab-btn hidden" data-tab="activity" id="activity-tab-btn">Actividad</button>
        </div>
        <div class="topbar-marquee"><span class="marquee-track"><span class="marquee-label">Pr√≥xima tarea:</span><span id="next-task-text">cargando...</span></span></div>
        <div id="auth-mini">
          <button id="auth-open-btn" class="btn btn-primary" type="button">Acceso</button>
          <span class="bell-wrap hidden" id="activity-bell-wrap">
            <button id="activity-bell-btn" class="btn btn-neutral" type="button" title="Notificaciones">üîî</button>
            <span id="activity-bell-dot" class="bell-dot hidden">0</span>
          </span>
          <button id="app-menu-btn" class="btn btn-neutral" type="button" title="Configuraci√≥n" style="display:none;">‚öôÔ∏è</button>
          <span id="auth-user-badge" style="color:#93c5fd; font-size:12px; font-weight:700;"></span>
          <button id="auth-logout-btn" class="btn btn-danger" type="button" style="display:none;">Cerrar sesi√≥n</button>
        </div>
      </div>
    </div>
    <div class="container">
      <h1>Bibliotecas</h1>

      <!-- Informaci√≥n: IP y relojes -->
      <div id="client-info">
        <div class="client-grid">
          <div class="client-item">
            <span class="k">IP Privada</span>
            <span class="v">IPv4: <span id="ip-v4">cargando...</span></span>
          </div>
          <div class="client-item">
            <span class="k">IP P√∫blica</span>
            <span class="v" id="ip-public">cargando...</span>
          </div>
          <div class="client-item"><span class="k">Hora Local</span><span class="v" id="time-local">--:--:--</span></div>
          <div class="client-item"><span class="k">Hora Santiago (CL)</span><span class="v" id="time-santiago">--:--:--</span></div>
          <div class="client-item"><span class="k">USD ‚Üí CLP</span><span class="v" id="usd-clp">cargando...</span></div>
          <div class="client-item"><span class="k">USD ‚Üí BRL</span><span class="v" id="usd-brl">cargando...</span></div>
        </div>
        <div style="margin-top:10px; padding:10px; border:1px solid #1e3a8a; border-radius:10px; background:linear-gradient(180deg,#0b1220,#070f1e);">
          <div style="display:flex; align-items:center; gap:8px; flex-wrap:wrap; margin-bottom:8px;">
            <strong>Conversor:</strong>
            <input id="fx-amount-input" type="number" step="0.01" min="0" value="100" placeholder="Escribe un monto" class="input" style="max-width:180px;" />
            <select id="fx-base-currency" class="input" style="max-width:170px;">
              <option value="USD">Monto en USD</option>
              <option value="CLP">Monto en CLP</option>
              <option value="BRL">Monto en BRL</option>
            </select>
          </div>
          <div style="display:flex; gap:10px; flex-wrap:wrap; color:#cbd5e1;">
            <span>CLP: <strong id="fx-out-clp">--</strong></span>
            <span>BRL: <strong id="fx-out-brl">--</strong></span>
            <span>USD: <strong id="fx-out-usd">--</strong></span>
          </div>
        </div>
      </div>

      <section id="tasks-section" data-section="tasks" class="hidden">
        <div class="subtabs">
          <button id="tasks-subtab-list" class="subtab-btn active" type="button" data-subtab="list">Lista</button>
          <button id="tasks-subtab-week" class="subtab-btn" type="button" data-subtab="week">Semana</button>
        </div>
        <h2>Crear tarea</h2>
        <button id="task-create-toggle" type="button" class="btn btn-primary" style="margin-bottom:8px;">Crear tarea</button>
        <form id="task-create-form" style="display:none;">
          <label>T√≠tulo<br/><input name="title" required /></label><br/>
          <label>Descripci√≥n (opcional)<br/><textarea name="description"></textarea></label><br/>
          <label>Inicio (ISO)<br/>
            <div class="input-with-icon" style="position:relative;">
              <input name="startAt" id="task-startAt" type="datetime-local" required />
              <button id="task-startAt-btn" type="button" title="Abrir calendario" style="position:absolute; right:8px; top:50%; transform:translateY(-50%); background:#374151; color:#fff; padding:4px 6px; border-radius:4px;">üìÖ</button>
            </div>
          </label><br/>
          <label>Duraci√≥n (minutos)<br/><input name="durationMinutes" type="number" min="1" required /></label><br/>
          <label>Tags (separados por coma)<br/><input name="tags" required /></label><br/>
          <label>Estado<br/>
            <select name="status">
              <option value="">(por defecto: En proceso)</option>
              <option value="IN_PROGRESS">En proceso</option>
              <option value="PAUSED">Detenida</option>
              <option value="STOPPED">Detenido</option>
              <option value="COMPLETED">Terminada</option>
            </select>
          </label><br/>
          <button type="submit">Crear tarea</button>
        </form>

        <h2 style="margin-top: 16px;">Lista de tareas <button id="toggle-tasks" class="toggle-list-btn" type="button">Contraer</button> <button id="tasks-censor-toggle" type="button" title="Ocultar contenido" style="background:#6b7280; margin-left:8px;">Modo P: OFF</button> <button id="tasks-calendar-btn" type="button" title="Calendario" style="background:#374151; margin-left:8px; display:inline-flex; align-items:center; gap:6px;">üìÖ Calendario</button></h2>
        <div id="tasks-start-alert" class="card" style="display:none; margin:8px 0 10px; padding:10px; border:1px solid #f59e0b; background:linear-gradient(180deg,#7c2d12,#5b1e0d); color:#fde68a; font-weight:700;"></div>
        <!-- Filtros superiores removidos -->
        <!--
        <div class="filters-row" style="margin-bottom:12px;">
          <label>Orden
            <select id="tasks-sort" class="input">
              <option value="all" selected>Todos</option>
              <option value="start-desc">Inicio m√°s cercano</option>
              <option value="start-asc">Inicio m√°s lejano</option>
              <option value="created-desc">Creaci√≥n reciente</option>
              <option value="created-asc">Creaci√≥n antigua</option>
            </select>
          </label>
          <label>Duraci√≥n m√≠n (min)
            <input type="number" id="tasks-min-duration" min="0" class="input" />
          </label>
          <label>Estado
            <select id="tasks-status-filter" class="input">
              <option value="">Todos</option>
              <option value="IN_PROGRESS">En proceso</option>
              <option value="PAUSED">Detenida</option>
              <option value="COMPLETED">Terminada</option>
            </select>
          </label>
          <label>Tags
            <input type="text" id="tasks-tag-filter" placeholder="ej: work, feature" class="input" />
          </label>
          <label>Desde
            <input type="date" id="tasks-date-from" class="input" />
          </label>
          <label>Hasta
            <input type="date" id="tasks-date-to" class="input" />
          </label>
          <button id="tasks-date-clear" type="button" class="btn btn-neutral" title="Limpiar rango">Limpiar rango</button>
          <button id="tasks-refresh" type="button" class="btn btn-neutral" title="Ver todos">‚Üª</button>
        </div>
        <div id="task-filter-chips" style="margin:6px 0 10px;"></div>
        -->
        <div id="tasks-pagination" style="display:flex; align-items:center; gap:8px; margin:8px 0;">
          <button id="tasks-page-prev" class="btn btn-neutral" type="button">‚óÄ</button>
          <span id="tasks-page-info" style="color:#94a3b8;"></span>
          <button id="tasks-page-next" class="btn btn-neutral" type="button">‚ñ∂</button>
          <label style="display:inline-flex; align-items:center; gap:6px; color:#94a3b8;">
            Ordenar
            <select id="tasks-sort" class="input" style="min-width:220px;">
              <option value="status">Por estado</option>
              <option value="created-desc" selected>Creaci√≥n m√°s reciente</option>
              <option value="start-near">Pr√≥xima a iniciar</option>
              <option value="duration-desc">Duraci√≥n m√°s larga</option>
              <option value="duration-asc">Duraci√≥n m√°s corta</option>
            </select>
          </label>
          <label style="margin-left:auto; display:inline-flex; align-items:center; gap:6px; color:#94a3b8;">
            Buscar
            <input id="tasks-search-any" type="text" placeholder="T√≠tulo, tags, estado, fecha..." class="input" style="min-width:260px; max-width:360px; border:1px solid #0ea5e9; border-radius:10px; background:linear-gradient(180deg,#0b1220,#070f1e); color:#f0f9ff; box-shadow:0 1px 0 rgba(125,211,252,0.14) inset;" />
          </label>
          <label style="margin-left:auto; display:inline-flex; align-items:center; gap:6px; color:#94a3b8;">Por p√°gina
            <select id="tasks-page-size" class="input" style="max-width:100px;">
              <option value="5">5</option>
              <option value="10" selected>10</option>
              <option value="20">20</option>
            </select>
          </label>
        </div>
        <ul id="tasks" class="collapsible expanded card"></ul>
        <div id="week-view-container" class="hidden card" style="margin-top:12px;">
          <div style="display:flex; align-items:center; justify-content:space-between; gap:8px; flex-wrap:wrap; margin-bottom:8px;">
            <h3 style="margin:0;">Vista por d√≠as (Carrusel)</h3>
            <div style="display:flex; align-items:center; gap:8px;">
              <button id="week-carousel-prev" type="button" class="btn btn-neutral" title="D√≠a anterior (‚Üê)" aria-label="Ver d√≠a anterior">‚óÄ</button>
              <span id="week-carousel-range" style="color:#cbd5e1; font-weight:700; min-width:220px; text-align:center;"></span>
              <button id="week-carousel-next" type="button" class="btn btn-neutral" title="D√≠a siguiente (‚Üí)" aria-label="Ver d√≠a siguiente">‚ñ∂</button>
            </div>
          </div>
          <div id="week-view"></div>
        </div>
        <!-- Modal Calendario de tareas -->
        <div id="tasks-calendar-modal" style="display:none; position:fixed; inset:0; background:rgba(2,6,23,0.7); backdrop-filter: blur(2px); z-index:1000; align-items:center; justify-content:center; padding:12px; box-sizing:border-box;">
          <div style="background:#0b1220; color:#e5e7eb; padding:16px; border:1px solid #1f2937; border-radius:12px; width:min(96vw, 1280px); max-height:92vh; overflow:auto; box-shadow:0 20px 50px rgba(0,0,0,0.6);">
            <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:12px; gap:8px; flex-wrap:wrap;">
              <strong style="font-size:18px;">Calendario de tareas</strong>
              <div style="display:flex; align-items:center; gap:8px; flex-wrap:wrap;">
                <button id="cal-prev" style="background:#374151; color:#fff; padding:6px 10px; border:none; border-radius:6px; cursor:pointer;">‚óÄ</button>
                <div id="cal-header" style="min-width:160px; text-align:center; font-weight:600; color:#cbd5e1;"></div>
                <button id="cal-next" style="background:#374151; color:#fff; padding:6px 10px; border:none; border-radius:6px; cursor:pointer;">‚ñ∂</button>
                <button id="cal-close" style="background:#ef4444; color:#fff; padding:6px 10px; border:none; border-radius:6px; cursor:pointer;">Cerrar</button>
              </div>
            </div>
            <div id="cal-grid-wrap" style="overflow:auto; width:100%; max-height:72vh; position:relative;">
              <div id="cal-trash-drop" style="display:none; margin-bottom:10px; padding:10px; border:1px dashed #ef4444; border-radius:10px; background:rgba(127,29,29,0.2); color:#fecaca; font-weight:700; text-align:center;">
                üóëÔ∏è Suelta aqu√≠ una tarea para eliminarla
              </div>
              <div id="cal-weekdays" style="display:grid; gap:8px; position:sticky; top:0; z-index:20; background:#0b1220; padding-bottom:6px;"></div>
              <div id="cal-grid" style="display:grid; gap:8px;">
                <!-- headers and days rendered by JS -->
              </div>
            </div>
            <div style="display:flex; align-items:center; justify-content:space-between; margin-top:12px;">
              <small style="color:#cbd5e1;">Leyenda: <span style="display:inline-block; width:10px; height:10px; background:#7c2d12; border:1px solid #f59e0b; border-radius:2px; vertical-align:middle; margin:0 4px 0 8px;"></span> Pasado <span style="display:inline-block; width:10px; height:10px; background:#0b2a5b; border:1px solid #3b82f6; border-radius:2px; vertical-align:middle; margin:0 4px 0 12px;"></span> Futuro</small>
              <small style="color:#94a3b8;">Doble click en üìÖ Calendario para limpiar filtro</small>
            </div>
          </div>
        </div>
      </section>
      <section data-section="tasks-board" id="tasks-board-section">
        <h2>Tablero de horarios</h2>
        <div id="tasks-board" class="tasks-board">
          <!-- Hour columns will be rendered by main.js -->
        </div>
      </section>
      <section id="payments-section" data-section="payments" class="hidden">
        <div class="subtabs">
          <button id="payments-subtab-list" class="subtab-btn active" type="button" data-subtab="list">Lista</button>
          <button id="payments-subtab-banks" class="subtab-btn" type="button" data-subtab="banks">Bancos</button>
        </div>
        <div id="payments-subtab-list-view">
        <h2>Crear pago</h2>
        <button id="payment-create-toggle" type="button" class="btn btn-primary" style="margin-bottom:8px;">Crear pago</button>
        <form id="payment-create-form" style="display:none;">
          <label>T√≠tulo<br/><input name="title" required /></label><br/>
          <label>Monto<br/><input name="amount" type="number" step="0.01" required /></label><br/>
          <label>Tipo<br/>
            <select name="type" required>
              <!-- Por defecto: Gasto extra -->
              <option value="EXTRA_EXPENSE" selected>Gasto extra</option>
              <option value="FIXED_EXPENSE">Gasto fijo</option>
              <option value="INCOME">Ingreso</option>
            </select>
          </label><br/>
          <label>Banco<br/>
            <select name="bank" required>
              <option value="FALABELLA">BANCO FALABELLA</option>
              <option value="ESTADO">BANCO ESTADO</option>
              <option value="CHILE">BANCO DE CHILE</option>
              <option value="SANTANDER">BANCO SANTANDER</option>
            </select>
          </label><br/>
          <label>Mes (YYYY-MM)<br/>
            <span style="display:flex; align-items:center; gap:6px;">
              <input name="month" type="month" />
              <button id="payment-create-month-btn" type="button" title="Abrir calendario" style="background:#3b82f6; color:#fff; padding:6px 8px; border:none; border-radius:6px; cursor:pointer; display:inline-flex; align-items:center; gap:6px;">üìÖ</button>
              <button id="payment-create-month-clear" type="button" title="Limpiar mes" style="background:#6b7280; color:#fff; padding:6px 8px; border:none; border-radius:6px; cursor:pointer;">Limpiar</button>
            </span>
          </label><br/>
          <label>Cuotas (1-58, opcional)<br/><input name="installments" type="number" min="1" max="58" /></label><br/>
          <label>Cuota actual pagada (0 si ninguna)<br/><input name="paidInstallments" type="number" min="0" max="58" /></label><br/>
          <button type="submit">Crear pago</button>
        </form>

        <h2 style="margin-top: 16px;">Lista de pagos <button id="toggle-payments" class="btn btn-neutral toggle-list-btn" type="button">Contraer</button> <button id="payments-censor-toggle" type="button" class="btn btn-neutral" title="Ocultar contenido">Modo P: OFF</button> <button id="payments-refresh" type="button" class="btn btn-neutral" title="Ver todos">‚Üª</button></h2>
        <!-- Filtros superiores removidos -->
        <!--
        <div class="filters-row" style="margin-bottom:12px;">
          <label>Banco
            <select id="payments-bank-filter" style="background:#0b1220; color:#e5e7eb; border:1px solid #334155; border-radius:6px; padding:6px 8px;">
              <option value="">Todos</option>
              <option value="FALABELLA">BANCO FALABELLA</option>
              <option value="ESTADO">BANCO ESTADO</option>
              <option value="SANTANDER">BANCO SANTANDER</option>
            </select>
          </label>
          <label>Tipo
            <select id="payments-type-filter" style="background:#0b1220; color:#e5e7eb; border:1px solid #334155; border-radius:6px; padding:6px 8px;">
              <option value="">Todos</option>
              <option value="INCOME">Ingreso</option>
              <option value="FIXED_EXPENSE">Gasto fijo</option>
              <option value="EXTRA_EXPENSE">Gasto extra</option>
            </select>
          </label>
          <label>Estado
            <select id="payments-status-filter" style="background:#0b1220; color:#e5e7eb; border:1px solid #334155; border-radius:6px; padding:6px 8px;">
              <option value="">Todos</option>
              <option value="PAYING">Pagando</option>
              <option value="PAID">Pagado</option>
              <option value="PAUSED">Detenido</option>
            </select>
          </label>
          <label>Mes
            <span style="display:flex; align-items:center; gap:6px;">
              <input type="month" id="payments-month-filter" class="input" />
              <button id="payments-month-btn" type="button" class="btn btn-primary" title="Abrir calendario">üìÖ</button>
              <button id="payments-month-clear" type="button" class="btn btn-neutral" title="Limpiar mes">Limpiar</button>
            </span>
          </label>
          <label>Desde
            <input type="date" id="payments-date-from" class="input" />
          </label>
          <label>Hasta
            <input type="date" id="payments-date-to" class="input" />
          </label>
          <button id="payments-date-clear" type="button" class="btn btn-neutral" title="Limpiar rango">Limpiar rango</button>
        </div>
        <div id="payments-filter-chips" style="margin:6px 0 10px;"></div>
        -->
        <div id="payments-pagination" style="display:flex; align-items:center; gap:8px; margin:8px 0;">
          <button id="payments-page-prev" class="btn btn-neutral" type="button">‚óÄ</button>
          <span id="payments-page-info" style="color:#94a3b8;"></span>
          <button id="payments-page-next" class="btn btn-neutral" type="button">‚ñ∂</button>
          <label style="margin-left:auto; display:inline-flex; align-items:center; gap:6px; color:#94a3b8;">
            Buscar
            <input id="payments-search-any" type="text" placeholder="T√≠tulo, banco, monto, estado..." class="input" style="min-width:260px; max-width:360px; border:1px solid #0ea5e9; border-radius:10px; background:linear-gradient(180deg,#0b1220,#070f1e); color:#f0f9ff; box-shadow:0 1px 0 rgba(125,211,252,0.14) inset;" />
          </label>
          <label style="display:inline-flex; align-items:center; gap:6px; color:#94a3b8;">Por p√°gina
            <select id="payments-page-size" class="input" style="max-width:100px;">
              <option value="5">5</option>
              <option value="10" selected>10</option>
              <option value="20">20</option>
            </select>
          </label>
        </div>
        <ul id="payments" class="collapsible expanded card"></ul>

        <!-- Charts containers -->
        <div class="payments-summary-box card">
          <div class="payments-summary">
            <div class="canvas-wrap card">
              <span class="canvas-title">Gastos vs Ingresos</span>
              <canvas id="payments-pie" width="720" height="260"></canvas>
            </div>
            <div class="legend">
              <div class="legend-item"><span class="legend-dot" style="background:#ef4444;"></span><span class="legend-label">Gasto fijo:</span> <span id="legend-fixed" class="legend-value">$0</span></div>
              <div class="legend-item"><span class="legend-dot" style="background:#f59e0b;"></span><span class="legend-label">Gasto extra:</span> <span id="legend-extra" class="legend-value">$0</span></div>
              <div class="legend-item"><span class="legend-dot" style="background:#10b981;"></span><span class="legend-label">Ingresos:</span> <span id="legend-income" class="legend-value">$0</span></div>
              <div class="legend-item"><span class="legend-dot" style="background:linear-gradient(45deg,#ef4444,#f59e0b);"></span><span class="legend-label">Total (sin ingresos):</span> <span id="legend-total" class="legend-value">$0</span></div>
              <div class="legend-item"><span class="legend-dot" style="background:linear-gradient(45deg,#10b981,#ef4444);"></span><span class="legend-label">Balance (ingresos - gastos):</span> <span id="legend-balance" class="legend-value">$0</span></div>
            </div>
          </div>
        </div>
        </div>
        <div id="payments-subtab-banks-view" class="hidden">
          <h2 style="margin-top: 4px;">Bancos</h2>
          <p style="color:#94a3b8; margin-top:0;">Resumen por banco con valores fijos editables y totales de pagos.</p>
          <div id="payments-banks-list" class="card" style="display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:12px;"></div>
        </div>
      </section>
      <section id="notes-section" data-section="notes" class="hidden">
        <div class="subtabs">
          <button id="notes-subtab-list" class="subtab-btn active" type="button">Notas</button>
          <button id="notes-subtab-errors" class="subtab-btn" type="button">Errores</button>
        </div>
        <div id="notes-subtab-list-view">
        <h2>Crear nota</h2>
        <button id="note-create-toggle" type="button" class="btn btn-primary" style="margin-bottom:8px;">Crear nota</button>
        <form id="note-create-form" style="display:none;">
          <label>T√≠tulo<br/><input name="title" required /></label><br/>
          <label>Contenido<br/><textarea name="content" required></textarea></label><br/>
          <label>Tags (separados por coma)<br/><input name="tags" /></label><br/>
          <button type="submit">Crear nota</button>
        </form>

        <h2 style="margin-top: 16px;">Notas <button id="toggle-notes" class="btn btn-neutral toggle-list-btn" type="button">Contraer</button> <button id="notes-censor-toggle" type="button" class="btn btn-neutral" title="Ocultar contenido">Modo P: OFF</button></h2>
        <div id="notes-pagination" style="display:flex; align-items:center; gap:8px; margin:8px 0;">
          <button id="notes-page-prev" class="btn btn-neutral" type="button">‚óÄ</button>
          <span id="notes-page-info" style="color:#94a3b8;"></span>
          <button id="notes-page-next" class="btn btn-neutral" type="button">‚ñ∂</button>
          <label style="margin-left:auto; display:inline-flex; align-items:center; gap:6px; color:#94a3b8;">
            Buscar
            <input id="notes-search-any" type="text" placeholder="T√≠tulo, contenido, tags..." class="input" style="min-width:260px; max-width:360px; border:1px solid #0ea5e9; border-radius:10px; background:linear-gradient(180deg,#0b1220,#070f1e); color:#f0f9ff; box-shadow:0 1px 0 rgba(125,211,252,0.14) inset;" />
          </label>
          <label style="display:inline-flex; align-items:center; gap:6px; color:#94a3b8;">Por p√°gina
            <select id="notes-page-size" class="input" style="max-width:100px;">
              <option value="5">5</option>
              <option value="10" selected>10</option>
              <option value="20">20</option>
            </select>
          </label>
        </div>
        <ul id="notes" class="collapsible expanded card"></ul>
        </div>
        <div id="notes-subtab-errors-view" class="hidden">
          <h2 style="margin-top: 6px;">Crear error</h2>
          <button id="notes-error-create-toggle" type="button" class="btn btn-primary" style="margin-bottom:8px;">Crear error</button>
          <h2 style="margin-top: 10px;">Lista de errores</h2>
          <div class="filters-row" style="margin-bottom:12px;">
            <label>Orden
              <select id="notes-errors-sort" class="input">
                <option value="desc">Recientes primero</option>
                <option value="asc">Antiguos primero</option>
              </select>
            </label>
            <label>Buscar
              <input type="text" id="notes-errors-search" placeholder="T√≠tulo, mensaje, soluci√≥n, tags..." class="input" style="min-width:260px; max-width:420px;" />
            </label>
            <button id="notes-errors-refresh" type="button" class="btn btn-neutral" title="Limpiar">‚Üª</button>
          </div>
          <ul id="notes-errors-list" class="card"></ul>
        </div>
      </section>
      <section id="profiles-section" data-section="profiles" class="hidden">
        <h2>Perfiles y usuarios</h2>
        <div style="display:flex; align-items:center; gap:8px; margin:8px 0 12px; flex-wrap:wrap;">
          <button id="profiles-create-btn" class="btn btn-primary" type="button">Crear usuario</button>
          <button id="profiles-refresh-btn" class="btn btn-neutral" type="button" title="Actualizar usuarios" aria-label="Actualizar usuarios">üîÑ</button>
          <input id="profiles-search-input" class="input" type="text" placeholder="Buscar email, username o rol" style="max-width:340px;" />
        </div>
        <ul id="profiles-users-list" class="card"></ul>
      </section>
      <section id="activity-section" data-section="activity" class="hidden">
        <h2>Actividad del sistema</h2>
        <div style="display:flex; gap:8px; align-items:center; margin:8px 0 12px;">
          <button id="activity-refresh-btn" class="btn btn-primary" type="button">Actualizar</button>
          <label style="display:inline-flex; gap:6px; align-items:center; color:#94a3b8;">L√≠mite
            <select id="activity-limit" class="input" style="max-width:100px;">
              <option value="50">50</option>
              <option value="100" selected>100</option>
              <option value="200">200</option>
            </select>
          </label>
        </div>
        <div id="activity-type-summary" style="display:flex; gap:8px; flex-wrap:wrap; margin:6px 0 12px;"></div>
        <ul id="activity-list" class="card"></ul>
      </section>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/plugins/monthSelect/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/es.js"></script>
    <script src="/main.js"></script>
  </body>
</html>
